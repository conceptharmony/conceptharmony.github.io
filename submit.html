    <script>
        // --- THEME & MENU LOGIC ---
        if (localStorage.getItem('theme') === 'light') document.body.classList.add('light-mode');
        
        document.getElementById('themeToggle').onclick = () => {
            document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
        };

        function toggleMenu() { document.getElementById('navLinks').classList.toggle('active'); }
        
        function toggleSocials(e) { 
            e.stopPropagation(); 
            document.getElementById('socialDropdown').classList.toggle('show'); 
        }
        
        window.onclick = function(e) { 
            if (!e.target.matches('.nav-btn')) document.getElementById('socialDropdown').classList.remove('show'); 
        }
        
        // --- HELPER FUNCTIONS ---
        const capitalize = (s) => s.replace(/\b\w/g, c => c.toUpperCase());

        function updateFileName(id, textId) {
            const input = document.getElementById(id);
            if(input.files.length > 0) document.getElementById(textId).innerText = "Selected: " + input.files[0].name;
        }

        function updateGalleryName() {
            const input = document.getElementById('galleryFiles');
            if(input.files.length > 0) document.getElementById('galleryText').innerText = `Selected ${input.files.length} images`;
        }

        // --- MODE SWITCHING ---
        let currentMode = 'device';
        function setMode(mode) {
            currentMode = mode;
            document.body.setAttribute('data-mode', mode);
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`button[onclick="setMode('${mode}')"]`).classList.add('active');

            if(mode === 'device') {
                document.getElementById('brand').placeholder = "e.g. Spinach";
                document.getElementById('model').placeholder = "e.g. Experix Ultra";
            } else {
                document.getElementById('brand').placeholder = "e.g. Tianyu";
                document.getElementById('model').placeholder = "e.g. EON 210";
            }
        }

        // --- DYNAMIC ROWS ---
        window.addEventListener('load', () => {
            addDynamicRow('cameraContainer', 'cam-type', 'cam-specs', 'Wide', '');
        });

        function addDynamicRow(containerId, classType, classSpecs, phType='Type', phSpecs='Specs') {
            const div = document.createElement('div');
            div.className = 'dynamic-row double-input';
            div.innerHTML = `
                <input type="text" class="${classType}" placeholder="${phType}" value="${phType === 'Wide' ? 'Wide' : ''}">
                <input type="text" class="${classSpecs}" placeholder="${phSpecs}">
                <button type="button" class="remove-btn" onclick="this.parentElement.remove()">X</button>
            `;
            document.getElementById(containerId).appendChild(div);
        }

        function addSingleInputRow(containerId, placeholder) {
            const div = document.createElement('div');
            div.className = 'dynamic-row single-input';
            div.innerHTML = `
                <input type="text" placeholder="${placeholder}">
                <button type="button" class="remove-btn" onclick="this.parentElement.remove()">X</button>
            `;
            document.getElementById(containerId).appendChild(div);
        }

        // ---------------------------------------------------------
        //  SMART FORMATTER
        // ---------------------------------------------------------
        function smartFormat(key, text) {
            if (!text) return null; // Return null if empty
            let val = text.trim();
            if (val === "") return null;

            const isCam = (key.includes('cam') || key.includes('camera') || key === 'camera_modules');

            // 1. Units & Terms
            val = val.replace(/(\d+)\s*hz\b/gi, "$1Hz").replace(/\bhz\b/gi, "Hz")
                     .replace(/(\d+)\s*ghz\b/gi, "$1GHz").replace(/\bghz\b/gi, "GHz")
                     .replace(/(\d+)\s*mhz\b/gi, "$1MHz").replace(/\bmhz\b/gi, "MHz");
            
            val = val.replace(/\bperf\b/gi, "Performance");
            val = val.replace(/\bnm\b/gi, "nm");
            val = val.replace(/\bgb\b/gi, "GB");
            val = val.replace(/\bmah\b/gi, "mAh").replace(/\bw\b/gi, "W");
            val = val.replace(/\bmp\b/gi, "MP").replace(/f\//gi, "f/");
            val = val.replace(/\bip(?=\d)/gi, "IP").replace(/\bip\s/gi, "IP ");

            if (key === 'cam_video' || key === 'all') val = val.replace(/\bfps\b/gi, "fps");

            if (key === 'battery') {
                val = val.replace(/li[\s-]ion/gi, "Li-Ion");
                val = val.replace(/si[\s-\/]+c|silicon\s+carbon/gi, "Si/C");
            }

            // 2. Display Terms
            if (['displayType', 'screen'].includes(key) || key === 'all') {
                const displayTerms = ['ltpo', 'ltps', 'oled', 'amoled', 'p-oled', 'ips', 'tft', 'lcd'];
                displayTerms.forEach(term => {
                    const regex = new RegExp(`\\b${term}\\b`, 'gi');
                    val = val.replace(regex, term.toUpperCase());
                });
            }

            // 3. Comma Logic
            val = val.replace(/,(?=[^\s])/g, ", ");

            // 4. Slash Expansion (Skip Camera)
            if (!isCam) {
                val = val.replace(/\//g, " / ");
                val = val.replace(/Si\s+\/\s+C/gi, "Si/C");
            }

            // 5. 'x' Spacing (Skip Camera)
            if (!isCam) {
                val = val.replace(/(\d)x(\d)/gi, "$1 x $2");
            }

            // 6. Capitalize Colors
            if (key === 'colors') {
                val = val.replace(/\b\w/g, c => c.toUpperCase());
            }

            return val;
        }

        // ---------------------------------------------------------
        //  OPTIMIZED GENERATOR
        // ---------------------------------------------------------
        document.getElementById('makerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            let data = {};

            const getVal = (id) => document.getElementById(id).value;
            
            // Helper to only add key if value exists
            const addIf = (key, val) => {
                if (val !== null && val !== undefined && val !== "") {
                    data[key] = val;
                }
            };

            // Identity
            addIf('brand', capitalize(getVal('brand')));
            addIf('model', capitalize(getVal('model')));
            
            // Dates
            const formatDate = (id) => {
                const val = getVal(id);
                if(!val) return null;
                const dateObj = new Date(val);
                const userTimezoneOffset = dateObj.getTimezoneOffset() * 60000;
                const adjustedDate = new Date(dateObj.getTime() + userTimezoneOffset);
                return adjustedDate.toLocaleString('default', { day: 'numeric', month: 'long', year: 'numeric' });
            };
            addIf('announced', formatDate('announced'));

            if (currentMode === 'device') {
                addIf('type', getVal('type'));
                addIf('status', getVal('status'));
                addIf('released', formatDate('released'));
                
                // Standard Fields
                const fields = ['ip_rating','weight','dimensions','colors','build','chipset','ram','storage','os','battery','charging','cam_video','cam_selfie'];
                fields.forEach(k => {
                    addIf(k, smartFormat(k, getVal(k)));
                });

                // Screen
                const sType = smartFormat('displayType', getVal('displayType'));
                const sRef = smartFormat('all', getVal('refresh')); 
                const sSize = getVal('screen');
                const sBri = getVal('brightness');
                
                let sArr = [];
                if(sType) sArr.push(sType);
                if(sRef) sArr.push(sRef);
                if(sSize) sArr.push(sSize + '"');
                if(sBri) sArr.push(sBri + ' nits');
                
                if(sArr.length > 0) data.screen = sArr.join(', ');
                addIf('resolution', getVal('resolution'));

                // Camera Modules (Array)
                const camRows = document.querySelectorAll('#cameraContainer .dynamic-row');
                const camModules = [];
                camRows.forEach(r => {
                    const inputs = r.querySelectorAll('input');
                    let label = inputs[0].value;
                    let specs = smartFormat('cam_specs', inputs[1].value);

                    if(label && specs) {
                        label = capitalize(label);
                        if (label === "Main") label = "Wide"; 
                        camModules.push({ label, specs });
                    }
                });
                if(camModules.length > 0) data.camera_modules = camModules;
                
                // Camera Features (Array of Strings)
                const camFeatRows = document.querySelectorAll('#camSensorContainer .dynamic-row input');
                const camFeats = [];
                camFeatRows.forEach(input => {
                    let val = smartFormat('camera_features', input.value);
                    if(val) {
                        val.split(',').forEach(v => { 
                            if(v.trim()) camFeats.push(v.trim()); 
                        });
                    }
                });
                if(camFeats.length > 0) data.camera_features = camFeats;

                // Sensors (Array of Strings)
                const sensRows = document.querySelectorAll('#sensorContainer .dynamic-row input');
                const sensors = [];
                sensRows.forEach(input => {
                    let val = smartFormat('sensors', input.value);
                    if(val) {
                        val.split(',').forEach(v => { 
                            if(v.trim()) sensors.push(v.trim()); 
                        });
                    }
                });
                if(sensors.length > 0) data.sensors = sensors;
            } 
            else { 
                // SoC Mode
                data.type = 'SoC';
                ['process','cpu_cores','gpu_model','gpu_clock','npu','isp','modem'].forEach(k => {
                    addIf(k, smartFormat('all', getVal(k)));
                });
            }

            // Extras
            ['geek_s','geek_m','antutu'].forEach(k => addIf(k, getVal(k)));
            
            // Pricing (Only add if value exists)
            const pUSD = getVal('price_usd');
            if(pUSD) data.price = '$' + pUSD;
            
            const pEUR = getVal('price_eur');
            if(pEUR) data.price_eur = 'â‚¬' + pEUR;

            // Images (Only add if selected)
            const f = document.getElementById('imageFile').files[0];
            if(f) data.image = "images/" + f.name;

            const gFiles = document.getElementById('galleryFiles').files;
            if(gFiles.length > 0) {
                const gal = [];
                for(let i=0; i<gFiles.length; i++) gal.push("images/" + gFiles[i].name);
                data.gallery = gal;
            }

            // Output without trailing comma logic to keep it simple JSON
            document.getElementById('outputArea').style.display = 'block';
            document.getElementById('jsonOutput').value = JSON.stringify(data, null, 4) + ",";
        });

        function copyText() {
            document.getElementById("jsonOutput").select();
            document.execCommand("copy");
            alert("Copied Code!");
        }
    </script>
